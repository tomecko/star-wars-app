(this["webpackJsonpstar-wars-app"]=this["webpackJsonpstar-wars-app"]||[]).push([[0],{32:function(e,t,n){e.exports=n(41)},40:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),o=n(24),l=n.n(o),c=n(31),i=n(51),u=n(52),s=n(53),m=n(28),f=[{name:"people",getScore:function(e){var t=e.mass;return Number(t)||0},getScoreText:function(e){return e.mass},scoreDescription:"mass"},{name:"starships",getScore:function(e){var t=e.crew;return Number(t)||0},getScoreText:function(e){return e.crew},scoreDescription:"crew"}],p=n(13),d=n(21),b=n(3),h=n(15),g=function(e,t){var n=e.map(t),r=Math.max.apply(Math,Object(h.a)(n));return 0===r?[]:Array.from(n.keys()).filter((function(e,t){return n[t]===r}))};function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var v=function(e){return Math.max(10,10*Math.ceil(Math.max.apply(Math,Object(h.a)(Object.keys(e).map((function(t){return e[t]}))))/10))};function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var O,w=n(25),j=n(26),P=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://swapi.co/api/";Object(w.a)(this,e),this.data={},this.rootUrl=t}return Object(j.a)(e,[{key:"getRandom",value:function(e,t){return this.getAll(e).then((function(e){return function(e){for(var t=e,n=t.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),a=[t[r],t[n]];t[n]=a[0],t[r]=a[1]}return t}(e.slice(0)).slice(0,t)}))}},{key:"getAll",value:function(e){var t=this;return this.data[e]?Promise.resolve(this.data[e]):this.getAllPageByPage("".concat(this.rootUrl).concat(e,"/")).then((function(n){return t.data[e]=n,n}))}},{key:"getAllPageByPage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return fetch(e).then((function(e){return e.json()})).then((function(e){return e.next?t.getAllPageByPage(e.next,n.concat(e.results)):n.concat(e.results)}))}}]),e}()),k=Object(d.a)({context:{battle:null,error:null,loadingShouldFail:Math.random()<.5,resourceInfo:null,scores:(O=2,Object(h.a)(Array(O).keys()).reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,Object(p.a)({},t,0))}),{}))},initial:"blank",states:{blank:{on:{INIT:"loading"}},loading:{invoke:{src:"loadingInvoke",onDone:"menu",onError:{target:"failure",actions:Object(b.b)({error:function(e,t){return t.data}})}}},failure:{on:{RETRY:{target:"loading",actions:Object(b.b)({error:null,loadingShouldFail:!1})}}},menu:{on:{PLAY:{target:"battle",actions:Object(b.b)({resourceInfo:function(e,t){return t.resourceInfo}})}}},battle:{invoke:{src:"battleInvoke",onDone:{actions:Object(b.b)({battle:function(e,t){return{items:t.data,winners:g(t.data,e.resourceInfo.getScore)}},scores:function(e,t){return g(t.data,e.resourceInfo.getScore).reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,Object(p.a)({},t,e[t]+1))}),e.scores)}})}},after:Object(p.a)({},3e3,"menu"),exit:Object(b.b)({battle:null})}}},{services:{loadingInvoke:function(e){return e.loadingShouldFail?Promise.reject(new Error("very informative error message")):Promise.all(f.map((function(e){var t=e.name;return P.getAll(t)})))},battleInvoke:function(e){return P.getRandom(e.resourceInfo.name,2)}}}),I=n(42),x=n(43),S=n(44);function A(e){var t=e.battle,n=e.resourceInfo,r=t.items,o=t.winners;return a.a.createElement(I.a,null,r&&r.map((function(e,t){return a.a.createElement(x.a,{key:t,body:!0,className:"text-center",inverse:!!o.includes(t)||void 0,color:o.includes(t)?"primary":void 0},a.a.createElement("p",null,a.a.createElement("strong",null,e.name),a.a.createElement("br",null),a.a.createElement(S.a,null,n.scoreDescription,": ",n.getScoreText(e))))})))}var D=n(45),M=n(54);function T(e){var t=e.error,n=e.send;return a.a.createElement(x.a,null,a.a.createElement(D.a,null,a.a.createElement("p",null,"Something went wrong",t?" (details: ".concat(t.message,")"):null,"."),a.a.createElement(M.a,{color:"danger",onClick:function(){return n("RETRY")}},"let's try again!")))}function N(){return a.a.createElement("footer",null,a.a.createElement(x.a,{body:!0},a.a.createElement("ul",null,a.a.createElement("li",null,"For demonstration purposes fetching data fails with 50% probability on the first attempt."),a.a.createElement("li",null,"Currently the app loads all data on startup. It does not scale and may take some time especially if SW API is slow :( Alternatively it would be possible to get random pair of ids on the client side and then fetch two items by their id. That would be correct only if made strong assumptions about all ids (i.e. ids are always subsequent integers). On the other hand the current solution (downloading all data) results in smooth and instantaneous interactions during the game."),a.a.createElement("li",null,"As a challenge I decided to try out a new approach toward handling app logic and configured state machine (XState). Naturally it would also be possible to set up Redux store or just use component's state as the app is relatively simple."))))}var R=n(46);function B(){return a.a.createElement(R.a,null,a.a.createElement("h1",null,"Star Wars App"),a.a.createElement("p",null,"Are you ready for the action?"))}var F=n(47);function W(){return a.a.createElement(x.a,null,a.a.createElement(D.a,null,a.a.createElement(F.a,{type:"grow",size:"sm",color:"primary"})," ","Loading\u2026"))}var Y=n(48),C=n(49);function L(e){var t=e.resourceInfo,n=e.send;return a.a.createElement(x.a,null,a.a.createElement(D.a,null,a.a.createElement(Y.a,null,"Please choose battle type."),a.a.createElement(C.a,null,f.map((function(e){return a.a.createElement(M.a,{key:e.name,color:"primary",onClick:function(){n({type:"PLAY",resourceInfo:e})}},e.name," ",t===e?a.a.createElement("small",null,"(continue)"):null)})))))}var J=n(50);function U(e){var t=e.scores;return a.a.createElement(x.a,{body:!0},Object.keys(t).map((function(e){return a.a.createElement("div",{key:e},"Player ",Number(e)+1,a.a.createElement(J.a,{value:Math.max(t[e],.5),max:v(t)},t[e]>0?t[e]:"0"))})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(39),n(40);l.a.render(a.a.createElement((function(e){var t=Object(m.useMachine)(e.machine||k),n=Object(c.a)(t,2),o=n[0],l=n[1];return Object(r.useEffect)((function(){l("INIT")}),[l]),a.a.createElement(i.a,null,a.a.createElement(u.a,null,a.a.createElement(s.a,{xs:"12",md:"8",lg:"6"},a.a.createElement(B,null),a.a.createElement(U,{scores:o.context.scores}),o.matches("loading")?a.a.createElement(W,null):"",o.matches("failure")?a.a.createElement(T,{error:o.context.error,send:l}):"",o.matches("menu")?a.a.createElement(L,{resourceInfo:o.context.resourceInfo,send:l}):null,o.matches("loading")||o.matches("menu")?a.a.createElement(N,null):null,o.matches("battle")&&o.context.battle?a.a.createElement(A,{battle:o.context.battle,resourceInfo:o.context.resourceInfo}):null)))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[32,1,2]]]);
//# sourceMappingURL=main.978856f2.chunk.js.map